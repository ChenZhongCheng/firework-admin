"use strict";angular.module("notifications",[]).factory("$notification",["$timeout",function(c){console.log("notification service online");var b=JSON.parse(localStorage.getItem("$notifications"))||[],a=[];var e={info:{duration:5000,enabled:true},warning:{duration:5000,enabled:true},error:{duration:5000,enabled:true},success:{duration:5000,enabled:true},progress:{duration:0,enabled:true},custom:{duration:35000,enabled:true},details:true,localStorage:false,html5Mode:false,html5DefaultIcon:"icon.png"};function d(h,k,j,g,i){if(window.webkitNotifications.checkPermission()===0){if(!h){h="favicon.ico"}var f=window.webkitNotifications.createNotification(h,k,j);if(typeof g==="function"){f.ondisplay=g}if(typeof i==="function"){f.onclose=i}f.show()}else{e.html5Mode=false}}return{disableHtml5Mode:function(){e.html5Mode=false},disableType:function(f){e[f].enabled=false},enableHtml5Mode:function(){e.html5Mode=this.requestHtml5ModePermissions()},enableType:function(f){e[f].enabled=true},getSettings:function(){return e},toggleType:function(f){e[f].enabled=!e[f].enabled},toggleHtml5Mode:function(){e.html5Mode=!e.html5Mode},requestHtml5ModePermissions:function(){if(window.webkitNotifications){console.log("notifications are available");if(window.webkitNotifications.checkPermission()===0){return true}else{window.webkitNotifications.requestPermission(function(){if(window.webkitNotifications.checkPermission()===0){e.html5Mode=true}else{e.html5Mode=false}});return false}}else{console.log("notifications are not supported");return false}},getAll:function(){return b},getQueue:function(){return a},info:function(h,g,f){console.log(h,g);return this.awesomeNotify("info","info",h,g,f)},error:function(h,g,f){return this.awesomeNotify("error","remove",h,g,f)},success:function(h,g,f){return this.awesomeNotify("success","ok",h,g,f)},warning:function(h,g,f){return this.awesomeNotify("warning","exclamation",h,g,f)},awesomeNotify:function(h,g,j,i,f){return this.makeNotification(h,false,g,j,i,f)},notify:function(h,i,g,f){return this.makeNotification("custom",h,true,i,g,f)},makeNotification:function(h,l,g,m,j,f){var k={type:h,image:l,icon:g,title:m,content:j,timestamp:+new Date(),userData:f};b.push(k);if(e.html5Mode){d(l,m,j,function(){console.log("inner on display function")},function(){console.log("inner on close function")})}else{a.push(k);c(function i(){a.splice(a.indexOf(k),1)},e[h].duration)}this.save();return k},save:function(){if(e.localStorage){localStorage.setItem("$notifications",JSON.stringify(b))}},restore:function(){},clear:function(){b=[];this.save()}}}]).directive("notifications",["$notification","$compile",function(e,c){console.log("this is a new directive");var b='<div class="dr-notification-wrapper" ng-repeat="noti in queue"><div class="dr-notification-close-btn" ng-click="removeNotification(noti)"><i class="icon-remove"></i></div><div class="dr-notification"><div class="dr-notification-image dr-notification-type-{{noti.type}}" ng-switch on="noti.image"><i class="icon-{{noti.icon}}" ng-switch-when="false"></i><img ng-src="{{noti.image}}" ng-switch-default /></div><div class="dr-notification-content"><h3 class="dr-notification-title">{{noti.title}}</h3><p class="dr-notification-text">{{noti.content}}</p></div></div></div>';function d(k,j,g){var f=g.notifications;f=f.split(" ");j.addClass("dr-notification-container");for(var h=0;h<f.length;h++){j.addClass(f[h])}}return{restrict:"A",scope:{},template:b,link:d,controller:["$scope",function a(f){f.queue=e.getQueue();f.removeNotification=function(g){f.queue.splice(f.queue.indexOf(g),1)}}]}}]);