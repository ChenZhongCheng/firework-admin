(function(){var a=window.angular.module("sx.tabs",["sx.tabs.tpls"]);a.directive("sxTabs",["$q","$rootScope","$http","$controller","$compile","$templateCache","$timeout","$tabsConsts",function(e,d,i,c,g,b,f,h){return{scope:{$options:"@sxTabsOptions",$tabs:"=sxTabs",$context:"=sxTabsContext",$onTabEnabled:"&sxTabsEnabled",$onTabDisabled:"&sxTabsDisabled",$onTabSwitched:"&sxTabSwitched"},templateUrl:h.template,link:function(u,o){u.activeTab={};u.entering=false;u.leaving=false;u.$options=window.angular.extend({},{cover:{enabled:false,autoAdjustHeight:false,hints:{entering:"加载中...",leaving:"验证中..."}}},u.$options);u.$context=u.$context||{};u.$onTabEnabled=u.$onTabEnabled||window.angular.noop;u.$onTabDisabled=u.$onTabDisabled||window.angular.noop;var v=function(){var w=false;window.angular.forEach(u.$tabs,function(x){if(!x.enabled){w=true}});u.showTabsPlusIcon=w;return w};var t=function(){var w=0;window.angular.forEach(u.$tabs,function(x){if(x.enabled){w++}});u.enabledTabsCount=w;return w};var r=function(x,z){var y=o.find(".sx-tabs-container");var w=y.find("div.outer");if(u.$options&&u.$options.cover&&u.$options.cover.enabled){if(x){if(u.$options.cover.autoAdjustHeight){f(function(){w.height(y.height());w.show();return z()})}else{w.show();return z()}}else{w.hide();return z()}}else{w.hide();return z()}};var j=function(w){if(w.template){w.$templatePromise=e.when(w)}else{w.$templatePromise=i.get(w.templateUrl,{cache:b}).then(function(x){w.template=x.data;return w})}};var l=function(A,w,y,z){u.leaving=true;if(A&&A.$scope){var x={toTabId:w.id,byTabDisable:y};A.$scope.$context.behavior.leaving(x,function(B){u.leaving=false;return z(B)})}else{u.leaving=false;return z(true)}};var n=function(x,w,y){u.entering=true;w.$scope.$context.behavior.entering({fromTabId:x,entered:w.entered},function(){w.entered=true;u.entering=false;return y()})};var m=function(w,y,x){if(!w.$scope||!w.$controller||y){w.$scope=u.$new();w.$scope.$context={data:u.$context,behavior:{entering:function(z,A){return A()},leaving:function(z,A){return A(true)}}};w.controller=w.controller||window.angular.noop;w.$controller=c(w.controller,{$scope:w.$scope});f(function(){var z=o.find('div.tab-wrapper[sx-tab-id="'+w.id+'"]');if(y){z[0].innerHTML=""}z.append(w.template);g(z.contents())(w.$scope);return x()})}else{return x()}};u.switchTab=function(x,C){C=C||window.angular.noop;var z=x.e;var B=x.id;var A=x.init;var w=x.byTabDisabled;if(z){z.preventDefault();z.stopPropagation()}if(B&&(!u.activeTab||!u.activeTab.id||u.activeTab.id!==B)){var y=u.$tabs[B];if(y){e.when(y.$templatePromise).then(function(){r(true,function(){l(u.activeTab,y,w,function(D){if(D){m(y,A,function(){var E=u.activeTab.id;u.activeTab=y;r(true,function(){n(E,y,function(){r(false,function(){window.angular.forEach(u.$tabs,function(G){G.isActive=(G.id===y.id)});u.$onTabSwitched({tab:y});var F=A?"-init":"-active";d.$broadcast(y.id+F,y);return C(true)})})})})}else{return C(false)}})})})}else{return C(false)}}else{return C(false)}};u.enableTab=function(y){var w=u.$tabs[y];var x=w&&!w.enabled;if(x){w.enabled=true}u.switchTab({e:null,id:y,byTabDisabled:false,init:x},function(z){u.$onTabEnabled({tab:w});v();t()})};u.$on("TAB_ENABLE",function(x,w){u.enableTab(w)});var q=function(w){var x=[];window.angular.forEach(u.$tabs,function(y){if(y.enabled||y.id===w){x.push(y.id)}});return x};var p=function(w){var z=q();var x=z.indexOf(w);var y=null;if(x>0){y=x-1}else{y=x+1}return z[y]};var k=function(w){w.enabled=false;u.$onTabDisabled({tab:w});v();t()};u.disableTab=function(y,z){if("dashboard"==z){return alert("首页标签不能删除")}if(y){y.preventDefault();y.stopPropagation()}var x=u.$tabs[z];if(x&&x.enabled){if(u.activeTab&&u.activeTab.id===x.id){var w=p(x.id);u.switchTab({e:null,id:w,byTabDisabled:true},function(A){if(A){k(x)}})}else{k(x)}}};var s=function(){var y=null;var w=null;var x=0;while(x<=u.$tabsOrder.length-1){if(u.$tabsOrder[x].enabled&&!y){y=u.$tabsOrder[x].id}if(u.$tabs[u.$tabsOrder[x].id].isActive&&u.$tabs[u.$tabsOrder[x].id].enabled&&!w){w=u.$tabsOrder[x].id}x++}return w||y};e.when(u.$tabs).then(function(w){u.$tabs=w;u.$tabsOrder=(function(){var x=[];window.angular.forEach(u.$tabs,function(y){x.push({id:y.id,order:y.order,enabled:y.enabled})});x.sort(function(z,A){return z.order-A.order});return x}());return e.when(u.$context)}).then(function(w){u.$context=w||{};u.showTabsPlusIcon=v();u.enabledTabsCount=t();window.angular.forEach(u.$tabs,function(x){x.entered=false;delete x.$scope;delete x.$controller;j(x)});u.switchTab({e:null,id:s(),byTabDisabled:true},window.angular.noop)})}}}])}());